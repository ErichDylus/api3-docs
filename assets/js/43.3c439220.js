(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{496:function(e,t,a){e.exports=a.p+"assets/img/request-outcomes.129b6aaf.png"},633:function(e,t,a){"use strict";a.r(t);var s=a(8),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"frontmatter-title"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#frontmatter-title"}},[e._v("#")]),e._v(" "+e._s(e.$frontmatter.title))]),e._v(" "),s("TocHeader"),e._v(" "),s("TOC",{staticClass:"table-of-contents",attrs:{"include-level":[2,3,4]}}),e._v(" "),s("p",[e._v("When a client makes a request using "),s("code",[e._v("AirnodeRrp.sol")]),e._v(", it is returned a "),s("code",[e._v("requestId")]),e._v(". This "),s("code",[e._v("requestId")]),e._v(" is a hash of all request parameters and a nonce. This allows Airnode to verify that the request parameters are not tampered with.")]),e._v(" "),s("h2",{attrs:{id:"request-parameters"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#request-parameters"}},[e._v("#")]),e._v(" Request parameters")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("airnodeId")]),e._v(" and "),s("code",[e._v("endpointId")]),e._v(" specify the endpoint")]),e._v(" "),s("li",[s("code",[e._v("requesterIndex")]),e._v(" and "),s("code",[e._v("designatedWallet")]),e._v(" specify which wallet will be used to fulfill the request")]),e._v(" "),s("li",[s("code",[e._v("fulfillAddress")]),e._v(" and "),s("code",[e._v("fulfillFunctionId")]),e._v(" specify which function will be called to fulfill the request")]),e._v(" "),s("li",[s("code",[e._v("parameters")]),e._v(" specify the API and "),s("RouterLink",{attrs:{to:"/next/reference/specifications/ois.html#_5-4-reservedparameters"}},[e._v("reserved")]),e._v(" parameters (see "),s("RouterLink",{attrs:{to:"/next/reference/specifications/airnode-abi-specifications.html"}},[e._v("Airnode ABI specifications")]),e._v(" for how these are encoded)")],1)]),e._v(" "),s("h2",{attrs:{id:"how-templates-are-used-in-requests"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-templates-are-used-in-requests"}},[e._v("#")]),e._v(" How templates are used in requests")]),e._v(" "),s("p",[e._v("A template includes the following fields:")]),e._v(" "),s("div",{staticClass:"language-solidity line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-solidity"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Template")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("bytes32")]),e._v(" airnodeId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("bytes32")]),e._v(" endpointId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint256")]),e._v(" requesterIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("address")]),e._v(" designatedWallet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("address")]),e._v(" fulfillAddress"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("bytes4")]),e._v(" fulfillFunctionId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("bytes")]),e._v(" parameters"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("p",[e._v("The client can refer to the "),s("code",[e._v("templateId")]),e._v(" of a template while making the request, and the Airnode will fetch these and use them in the request. Among these, "),s("code",[e._v("requesterIndex")]),e._v(", "),s("code",[e._v("designatedWallet")]),e._v(", "),s("code",[e._v("fulfillAddress")]),e._v(", "),s("code",[e._v("fulfillFunctionId")]),e._v(" can be overridden by parameters defined at request-time.")]),e._v(" "),s("p",[e._v("When a template is used to make a request, both the parameters encoded in "),s("code",[e._v("parameters")]),e._v(" of the template and "),s("code",[e._v("parameters")]),e._v(" provided at request-time by the client will be used by the Airnode. In case the two include a parameter with the same name, the one provided at request-time will be used.")]),e._v(" "),s("h2",{attrs:{id:"request-types"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#request-types"}},[e._v("#")]),e._v(" Request types")]),e._v(" "),s("p",[e._v("There are multiple request types with respect to how they utilize templates:")]),e._v(" "),s("h3",{attrs:{id:"_1-regular-request"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-regular-request"}},[e._v("#")]),e._v(" 1. Regular request")]),e._v(" "),s("p",[e._v("A regular request refers to a template, yet provides its own "),s("code",[e._v("requesterIndex")]),e._v(", "),s("code",[e._v("designatedWallet")]),e._v(", "),s("code",[e._v("fulfillAddress")]),e._v(", "),s("code",[e._v("fulfillFunctionId")]),e._v(" that will override the ones from the template.")]),e._v(" "),s("h3",{attrs:{id:"_2-short-request"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-short-request"}},[e._v("#")]),e._v(" 2. Short request")]),e._v(" "),s("p",[e._v("A short request refers to a template for all parameters.")]),e._v(" "),s("h3",{attrs:{id:"_3-full-request"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-full-request"}},[e._v("#")]),e._v(" 3. Full request")]),e._v(" "),s("p",[e._v("A full request does not refer to a template at all. They are useful if the client will not make a similar request ever again (e.g., in a prediction market context).")]),e._v(" "),s("h2",{attrs:{id:"request-outcomes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#request-outcomes"}},[e._v("#")]),e._v(" Request outcomes")]),e._v(" "),s("p",[e._v("A request made to an Airnode has three possible outcomes:")]),e._v(" "),s("ul",[s("li",[e._v("Fulfill")]),e._v(" "),s("li",[e._v("Fail")]),e._v(" "),s("li",[e._v("Ignore")])]),e._v(" "),s("h3",{attrs:{id:"fulfill"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fulfill"}},[e._v("#")]),e._v(" Fulfill")]),e._v(" "),s("p",[s("code",[e._v("fulfill()")]),e._v(" is the desired outcome and comes as "),s("em",[e._v("success")]),e._v(" (statusCode = 0) or as "),s("em",[e._v("errored")]),e._v(" ("),s("RouterLink",{attrs:{to:"/next/reference/protocols/request-response/request.html#statuscode"}},[e._v("statusCode")]),e._v(" > 0). This is the only outcome that returns results to a client contract.")],1),e._v(" "),s("p",[e._v("For a successful request, Airnode  calls the "),s("code",[e._v("fulfill()")]),e._v(" function in "),s("code",[e._v("AirnodeRRP.sol")]),e._v(" that will in turn call back the client contract at "),s("code",[e._v("fulfillAddress")]),e._v(" using function "),s("code",[e._v("fulfillFunctionId")]),e._v(" to deliver "),s("code",[e._v("data")]),e._v(" and a "),s("a",{attrs:{href:"https://github.com/api3dao/airnode/blob/6f31a4c27d40e86101673bf37d223fef6625dfdd/packages/protocol/contracts/AirnodeRrp.sol#L148",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("statusCode")]),s("OutboundLink")],1),e._v(" of 0. If there was an error then statusCode will be non-0. The client contract can then handle this error as it sees fit (e.g., ignore it, make a request to an alternative provider, etc.)")]),e._v(" "),s("blockquote",[s("p",[s("img",{attrs:{src:a(496),alt:"request-outcomes"}})])]),e._v(" "),s("h3",{attrs:{id:"fail"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fail"}},[e._v("#")]),e._v(" Fail")]),e._v(" "),s("p",[e._v("As noted in the diagram above, if the transaction that calls "),s("code",[e._v("fulfill()")]),e._v(" reverts, the node calls the "),s("code",[e._v("fail()")]),e._v(" method to report the failure. The node will not attempt to fulfill a failed request afterwards.")]),e._v(" "),s("Todo",[s("p",[e._v("The following three paragraphs are a little dense. See Github issue: https://github.com/api3dao/api3-docs/issues/108")])]),e._v(" "),s("p",[e._v('Airnode is stateless, which means that there is no database storing which requests have been fulfilled or failed,\nwhich are waiting on confirmations and which are still pending. This information is retrieved from the chain on\neach request-response cycle (roughly every minute). During each cycle, retrieved requests need to be ordered in\nthe same way to ensure they are submitted using the same nonce. This is important because it\'s possible for a\ntransaction to not have been confirmed by the time the next cycle runs. If this happens, the transaction is\nre-submitted with a "faster" transaction fee, overwriting the previous transaction.')]),e._v(" "),s("p",[e._v('However, Airnode is also dependent on the blockchain provider to supply it with the onchain data. If the\nblockchain provider is unavailable for whatever reason, it is possible that a request cannot be fully validated,\nwhich means that it cannot be submitted back to the blockchain. As mentioned above, keeping requests in the\nsame order, using the same nonce is critical. Therefore, any request that cannot be fully validated due to a\nblockchain provider error becomes "blocked". This means that it and any requests after it are unable to be\nsubmitted during the current cycle and will be retried during the following cycle. It is important to note\nthat this is specific to each requester. e.g. a request sent from requester A that becomes "blocked", will\nnot block requests sent from requester B.')]),e._v(" "),s("p",[e._v('After X blocks (20 by default for EVM chains), any requests that would become "blocked", will instead become "ignored".\nThis means that Airnode will stop attempting to process the request in order to process later requests.')]),e._v(" "),s("h3",{attrs:{id:"ignore"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ignore"}},[e._v("#")]),e._v(" Ignore")]),e._v(" "),s("p",[e._v("If the Airnode cannot even fail a request (e.g., the client is not endorsed by the requester), the request gets ignored.")]),e._v(" "),s("h2",{attrs:{id:"statuscode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#statuscode"}},[e._v("#")]),e._v(" statusCode")]),e._v(" "),s("p",[e._v("Airnodes will return a "),s("code",[e._v("statusCode")]),e._v(" when responding to a request. A non-0 statusCode is an error.")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"right"}},[e._v("Code")]),e._v(" "),s("th",[e._v("Name")]),e._v(" "),s("th",[e._v("Status")]),e._v(" "),s("th",[e._v("Description")])])]),e._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("1")]),e._v(" "),s("td",[e._v("RequestParameterDecodingFailed")]),e._v(" "),s("td",[e._v("Errored")]),e._v(" "),s("td",[e._v("The request contains invalid parameters")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("2")]),e._v(" "),s("td",[e._v("RequestInvalid")]),e._v(" "),s("td",[e._v("Ignored")]),e._v(" "),s("td",[e._v("The request ID cannot be verified against the other fields")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("3")]),e._v(" "),s("td",[e._v("TemplateNotFound")]),e._v(" "),s("td",[e._v("Blocked")]),e._v(" "),s("td",[e._v("The API call template could not be loaded")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("4")]),e._v(" "),s("td",[e._v("TemplateParameterDecodingFailed")]),e._v(" "),s("td",[e._v("Errored")]),e._v(" "),s("td",[e._v("The API call template contains invalid parameters")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("5")]),e._v(" "),s("td",[e._v("TemplateInvalid")]),e._v(" "),s("td",[e._v("Ignored")]),e._v(" "),s("td",[e._v("The API call template cannot be verified against the other fields")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("6")]),e._v(" "),s("td",[e._v("DesignatedWalletInvalid")]),e._v(" "),s("td",[e._v("Ignored")]),e._v(" "),s("td",[e._v("The request's designated wallet differs from the expected designated wallet")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("7")]),e._v(" "),s("td",[e._v("AuthorizationNotFound")]),e._v(" "),s("td",[e._v("Blocked")]),e._v(" "),s("td",[e._v("The API call authorization status could not be loaded")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("8")]),e._v(" "),s("td",[e._v("Unauthorized")]),e._v(" "),s("td",[e._v("Errored")]),e._v(" "),s("td",[e._v("The client contract submitting the API call request is not authorized")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("9")]),e._v(" "),s("td",[e._v("PendingWithdrawal")]),e._v(" "),s("td",[e._v("Ignored")]),e._v(" "),s("td",[e._v("The request cannot be actioned while there is a pending withdrawal")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("10")]),e._v(" "),s("td",[e._v("UnknownOIS")]),e._v(" "),s("td",[e._v("Errored")]),e._v(" "),s("td",[e._v("The API call endpointId does not match a known OIS")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("11")]),e._v(" "),s("td",[e._v("UnknownEndpoint")]),e._v(" "),s("td",[e._v("Errored")]),e._v(" "),s("td",[e._v("The API call endpointId does not match a known endpoint")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("12")]),e._v(" "),s("td",[e._v("NoMatchingAggregatedCall")]),e._v(" "),s("td",[e._v("Ignored")]),e._v(" "),s("td",[e._v("The individual API call cannot be matched to an aggregated API call")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("13")]),e._v(" "),s("td",[e._v("ApiCallFailed")]),e._v(" "),s("td",[e._v("Errored")]),e._v(" "),s("td",[e._v("The API call failed")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("14")]),e._v(" "),s("td",[e._v("ResponseParametersInvalid")]),e._v(" "),s("td",[e._v("Errored")]),e._v(" "),s("td",[e._v('The API call is missing a "_type" parameter')])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("15")]),e._v(" "),s("td",[e._v("ResponseValueNotFound")]),e._v(" "),s("td",[e._v("Errored")]),e._v(" "),s("td",[e._v('A value could not be extracted from the API call response using the "_path" parameter')])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("16")]),e._v(" "),s("td",[e._v("ResponseValueNotCastable")]),e._v(" "),s("td",[e._v("Errored")]),e._v(" "),s("td",[e._v('The API call response value could not be cast successfully using the "_type" parameter')])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"right"}},[e._v("17")]),e._v(" "),s("td",[e._v("FulfillTransactionFailed")]),e._v(" "),s("td",[e._v("Errored")]),e._v(" "),s("td",[e._v("The fulfill transaction could not be submitted successfully")])])])])],1)}),[],!1,null,null,null);t.default=r.exports}}]);